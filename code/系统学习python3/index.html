<!-- build time:Sat Dec 20 2025 13:06:05 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="http://amentiraz.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" href="http://amentiraz.github.io/atom.xml"><link rel="alternate" type="application/json" href="http://amentiraz.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="学习笔记,python"><link rel="canonical" href="http://amentiraz.github.io/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python3/"><title>系统学习python（三）对于Anndata的整理 - python - 代码 | Amentiraz =</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">系统学习python（三）对于Anndata的整理</h1><div class="meta"><span class="item" title="创建时间：2025-05-04 16:51:40"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2025-05-04T16:51:40+08:00">2025-05-04</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.9k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>4 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Amentiraz</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://amentirazblogpic.oss-cn-hangzhou.aliyuncs.com/blogpic/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925162923.png"></li><li class="item" data-background-image="https://amentirazblogpic.oss-cn-hangzhou.aliyuncs.com/blogpic/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925124403.png"></li><li class="item" data-background-image="https://amentirazblogpic.oss-cn-hangzhou.aliyuncs.com/blogpic/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925124347.png"></li><li class="item" data-background-image="https://amentirazblogpic.oss-cn-hangzhou.aliyuncs.com/blogpic/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925124538.jpg"></li><li class="item" data-background-image="https://amentirazblogpic.oss-cn-hangzhou.aliyuncs.com/blogpic/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925124532.jpg"></li><li class="item" data-background-image="https://amentirazblogpic.oss-cn-hangzhou.aliyuncs.com/blogpic/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925162737.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/code/" itemprop="item" rel="index" title="分类于 代码"><span itemprop="name">代码</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/code/python/" itemprop="item" rel="index" title="分类于 python"><span itemprop="name">python</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://amentiraz.github.io/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Lemon Sour"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><p>接着上文继续学习 Anndata 的相关语法，<span class="exturl" data-url="aHR0cHM6Ly9hbm5kYXRhLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC90dXRvcmlhbHMvbm90ZWJvb2tzL2dldHRpbmctc3RhcnRlZC5odG1s"> 参考网页</span></p><span id="more"></span><p><code>AnnData</code> is specifically designed for matrix-like data. By this we mean that we have <code>n</code> observations, each of which can be represented as <code>d</code> -dimensional vectors, where each dimension corresponds to a variable or feature. Both the rows and columns of this <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>d</mi></mrow><annotation encoding="application/x-tex">n \times d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal">d</span></span></span></span> matrix are special in the sense that they are indexed.</p><p>For instance, in scRNA-seq data, each row corresponds to a cell with a barcode, and each column corresponds to a gene with a gene id. Furthermore, for each cell and each gene we might have additional metadata, like (1) donor information for each cell, or (2) alternative gene symbols for each gene.</p><h1 id="initializing-anndata"><a class="anchor" href="#initializing-anndata">#</a> Initializing AnnData</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">counts = csr_matrix(np.random.poisson(<span class="number">1</span>, size=(<span class="number">100</span>, <span class="number">2000</span>)), dtype=np.float32)</span><br><span class="line"><span class="comment"># 生成一个参数为1的泊松分布的稀疏矩阵</span></span><br><span class="line">adata = ad.AnnData(counts)</span><br><span class="line"><span class="built_in">print</span>(adata)</span><br><span class="line"></span><br><span class="line">adata.obs_names = [<span class="string">f&quot;Cell_<span class="subst">&#123;i:d&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(adata.n_obs)]</span><br><span class="line">adata.var_names = [<span class="string">f&quot;Gene_<span class="subst">&#123;i:d&#125;</span>&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(adata.n_vars)]</span><br><span class="line"><span class="built_in">print</span>(adata.obs_names)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(adata[[<span class="string">&quot;Cell_1&quot;</span>, <span class="string">&quot;Cell_10&quot;</span>], [<span class="string">&quot;Gene_5&quot;</span>, <span class="string">&quot;Gene_1900&quot;</span>]])</span><br></pre></td></tr></table></figure><h1 id="adding-aligned-metadata"><a class="anchor" href="#adding-aligned-metadata">#</a> Adding aligned metadata</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ct = np.random.choice([<span class="string">&quot;B&quot;</span>, <span class="string">&quot;T&quot;</span>, <span class="string">&quot;Monocyte&quot;</span>], size=(adata.n_obs))</span><br><span class="line">adata.obs[<span class="string">&quot;cell_type&quot;</span>] = pd.Categorical(ct)</span><br><span class="line"><span class="built_in">print</span>(adata.obs)</span><br><span class="line"></span><br><span class="line">bdata = adata[adata.obs.cell_type == <span class="string">&quot;B&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(bdata)</span><br></pre></td></tr></table></figure><h1 id="observation-variable-level-matrices"><a class="anchor" href="#observation-variable-level-matrices">#</a> Observation / variable-level matrices</h1><p>We might also have metadata at either level that has many dimensions to it, such as a <code>UMAP</code> embedding of the data. For this type of metadata, AnnData has the <code>.obsm/.varm</code> attributes. We use keys to identify the different matrices we insert. The restriction of <code>.obsm/.varm</code> are that <code>.obsm</code> matrices must length equal to the number of observations as .n_obs and <code>.varm</code> matrices must length equal to <code>.n_vars</code> . They can each independently have different number of dimensions.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adata.obsm[<span class="string">&quot;X_umap&quot;</span>] = np.random.normal(<span class="number">0</span>,<span class="number">1</span>,size=(adata.n_obs,<span class="number">2</span>))</span><br><span class="line">adata.varm[<span class="string">&quot;gene_stuff&quot;</span>] = np.random.normal(<span class="number">0</span>,<span class="number">1</span>,size=(adata.n_vars,<span class="number">5</span>))</span><br><span class="line"><span class="built_in">print</span>(adata)</span><br></pre></td></tr></table></figure><p>A few more notes about <code>.obsm/.varm</code></p><ul><li><p>The “array-like” metadata can originate from a Pandas DataFrame, scipy sparse matrix, or numpy dense array.</p></li><li><p>When using scanpy, their values (columns) are not easily plotted, where instead items from .obs are easily plotted on, e.g., UMAP plots.</p></li></ul><h1 id="unstructured-metadata"><a class="anchor" href="#unstructured-metadata">#</a> Unstructured metadata</h1><p>AnnData has <code>.uns</code> , which allows for any unstructured metadata. This can be anything, like a list or a dictionary with some general information that was useful in the analysis of our data.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adata.uns[<span class="string">&quot;random&quot;</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">adata.uns</span><br></pre></td></tr></table></figure><h1 id="layers"><a class="anchor" href="#layers">#</a> Layers</h1><p>Finally, we may have different forms of our original core data, perhaps one that is normalized and one that is not. These can be stored in different layers in AnnData. For example, let’s log transform the original data and store it in a layer:</p><h1 id="conversion-to-dataframe"><a class="anchor" href="#conversion-to-dataframe">#</a> Conversion to DataFrame</h1><p>We can also ask AnnData to return us a DataFrame from one of the layers:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adata.to_df(layer=<span class="string">&quot;log_transformed&quot;</span>)</span><br></pre></td></tr></table></figure><p>We see that the .obs_names/.var_names are used in the creation of this Pandas object.</p><h1 id="writing-the-results-to-disk"><a class="anchor" href="#writing-the-results-to-disk">#</a> Writing the results to disk</h1><p>AnnData comes with its own persistent HDF5-based file format: h5ad. If string columns with small number of categories aren’t yet categoricals, AnnData will auto-transform to categoricals.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adata.write(<span class="string">&#x27;my_results.h5ad&#x27;</span>, compression=<span class="string">&quot;gzip&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="views-and-copies"><a class="anchor" href="#views-and-copies">#</a> Views and copies</h1><p>Imagine that the observations come from instruments characterizing 10 readouts in a multi-year study with samples taken from different subjects at different sites. We’d typically get that information in some format and then store it in a DataFrame:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">obs_meta = pd.DataFrame(&#123;</span><br><span class="line">        <span class="string">&#x27;time_yr&#x27;</span>: np.random.choice([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>], adata.n_obs),</span><br><span class="line">        <span class="string">&#x27;subject_id&#x27;</span>: np.random.choice([<span class="string">&#x27;subject 1&#x27;</span>, <span class="string">&#x27;subject 2&#x27;</span>, <span class="string">&#x27;subject 4&#x27;</span>, <span class="string">&#x27;subject 8&#x27;</span>], adata.n_obs),</span><br><span class="line">        <span class="string">&#x27;instrument_type&#x27;</span>: np.random.choice([<span class="string">&#x27;type a&#x27;</span>, <span class="string">&#x27;type b&#x27;</span>], adata.n_obs),</span><br><span class="line">        <span class="string">&#x27;site&#x27;</span>: np.random.choice([<span class="string">&#x27;site x&#x27;</span>, <span class="string">&#x27;site y&#x27;</span>], adata.n_obs),</span><br><span class="line">    &#125;,</span><br><span class="line">    index=adata.obs.index,    <span class="comment"># these are the same IDs of observations as above!</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>This is how we join the readout data with the metadata. Of course, the first argument of the following call for X could also just be a DataFrame.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adata = ad.AnnData(adata.X, obs=obs_meta, var=adata.var)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># View</span></span><br><span class="line">adata[:<span class="number">5</span>, [<span class="string">&quot;Gene_1&quot;</span>, <span class="string">&quot;Gene_3&quot;</span>]]</span><br><span class="line"><span class="comment"># .toarray()表示转换为稠密的 NumPy数组，.tolist()表示转换成Python列表，方便查看</span></span><br><span class="line"><span class="built_in">print</span>(adata[:<span class="number">3</span>, <span class="string">&quot;Gene_1&quot;</span>].X.toarray().tolist())</span><br><span class="line"><span class="built_in">print</span>(adata[:<span class="number">3</span>, <span class="string">&quot;Gene_1&quot;</span>].X.toarray())</span><br><span class="line">adata[:<span class="number">3</span>, <span class="string">&quot;Gene_1&quot;</span>].X = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(adata[:<span class="number">3</span>, <span class="string">&quot;Gene_1&quot;</span>].X.toarray().tolist())</span><br><span class="line"><span class="comment"># Copy</span></span><br><span class="line">adata_subset = adata[:<span class="number">5</span>, [<span class="string">&quot;Gene_1&quot;</span>, <span class="string">&quot;Gene_3&quot;</span>]].copy()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="partial-reading-of-large-data"><a class="anchor" href="#partial-reading-of-large-data">#</a> Partial reading of large data</h1><p>If a single <code>.h5ad</code> is very large, you can partially read it into memory by using backed mode:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adata = ad.read(<span class="string">&#x27;my_results.h5ad&#x27;</span>, backed=<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">adata.isbacked</span><br></pre></td></tr></table></figure><p>If you do this, you’ll need to remember that the AnnData object has an open connection to the file used for reading:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adata.filename</span><br><span class="line">PosixPath(<span class="string">&#x27;my_results.h5ad&#x27;</span>)</span><br></pre></td></tr></table></figure><p>As we’re using it in read-only mode, we can’t damage anything. To proceed with this tutorial, we still need to explicitly close it:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adata.file.close()</span><br></pre></td></tr></table></figure><p>As usual, you should rather use with statements to avoid dangling open files (up-coming feature).</p><p>Manipulating the object on disk is possible, but experimental for sparse data. Hence, we leave it out of this tutorial.</p><p>上面包含了一些非常基础的操作，考虑到时间关系和后面的内容有些难，我先去学习一下 scanpy 的操作流程</p><div class="tags"><a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag"><i class="ic i-tag"></i> 学习笔记</a> <a href="/tags/python/" rel="tag"><i class="ic i-tag"></i> python</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2025-05-05 11:22:48" itemprop="dateModified" datetime="2025-05-05T11:22:48+08:00">2025-05-05</time> </span><span id="code/系统学习python3/" class="item leancloud_visitors" data-flag-title="系统学习python（三）对于Anndata的整理" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Lemon Sour <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="http://amentiraz.github.io/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python3/" title="系统学习python（三）对于Anndata的整理">http://amentiraz.github.io/code/系统学习python3/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC96aC1DTg=="><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python2/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;amentirazblogpic.oss-cn-hangzhou.aliyuncs.com&#x2F;blogpic&#x2F;%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925124434.jpg" title="系统学习python（二）对于pandas的整理"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> python</span><h3>系统学习python（二）对于pandas的整理</h3></a></div><div class="item right"><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python4/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;amentirazblogpic.oss-cn-hangzhou.aliyuncs.com&#x2F;blogpic&#x2F;%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240925124538.jpg" title="系统学习python（四）对于Scanpy的整理"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> python</span><h3>系统学习python（四）对于Scanpy的整理</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#initializing-anndata"><span class="toc-number">1.</span> <span class="toc-text">Initializing AnnData</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#adding-aligned-metadata"><span class="toc-number">2.</span> <span class="toc-text">Adding aligned metadata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#observation-variable-level-matrices"><span class="toc-number">3.</span> <span class="toc-text">Observation &#x2F; variable-level matrices</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unstructured-metadata"><span class="toc-number">4.</span> <span class="toc-text">Unstructured metadata</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#layers"><span class="toc-number">5.</span> <span class="toc-text">Layers</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#conversion-to-dataframe"><span class="toc-number">6.</span> <span class="toc-text">Conversion to DataFrame</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#writing-the-results-to-disk"><span class="toc-number">7.</span> <span class="toc-text">Writing the results to disk</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#views-and-copies"><span class="toc-number">8.</span> <span class="toc-text">Views and copies</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#partial-reading-of-large-data"><span class="toc-number">9.</span> <span class="toc-text">Partial reading of large data</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python/" rel="bookmark" title="系统学习python(一）对于NumPy的整理">系统学习python(一）对于NumPy的整理</a></li><li><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python2/" rel="bookmark" title="系统学习python（二）对于pandas的整理">系统学习python（二）对于pandas的整理</a></li><li class="active"><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python3/" rel="bookmark" title="系统学习python（三）对于Anndata的整理">系统学习python（三）对于Anndata的整理</a></li><li><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python4/" rel="bookmark" title="系统学习python（四）对于Scanpy的整理">系统学习python（四）对于Scanpy的整理</a></li><li><a href="/note/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6%E6%95%B0%E6%8D%AE/" rel="bookmark" title="系统学习如何处理生物信息学数据">系统学习如何处理生物信息学数据</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Lemon Sour" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Lemon Sour</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">100</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">26</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">63</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FtZW50aXJheg==" title="https:&#x2F;&#x2F;github.com&#x2F;Amentiraz"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9kc2ZseS04" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;dsfly-8"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTE1MTc2ODUzMzM=" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;1517685333"><i class="ic i-cloud-music"></i></span> <span class="exturl item email" data-url="bWFpbHRvOnZpb2xlbW9uQDE2My5jb20=" title="mailto:violemon@163.com"><i class="ic i-envelope"></i></span> <span class="exturl item bangumi" data-url="aHR0cHM6Ly9iYW5ndW1pLnR2L2FuaW1lL2xpc3QvNjY4MDE2" title="https:&#x2F;&#x2F;bangumi.tv&#x2F;anime&#x2F;list&#x2F;668016"><i class="ic i-bilibili"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-magic"></i>关于</a><ul class="submenu"><li class="item"><a href="/author/" rel="section"><i class="ic i-user"></i>本人</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-cloud"></i>其它</a><ul class="submenu"><li class="item"><a href="/music/" rel="section"><i class="ic i-music"></i>音乐区</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>朋友</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python2/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python4/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/life/" title="分类于 生活">生活</a> <i class="ic i-angle-right"></i> <a href="/categories/life/%E6%80%9D%E8%80%83/" title="分类于 思考">思考</a></div><span><a href="/life/%E6%88%96%E8%AE%B8%E6%88%91%E4%BB%AC%E6%B0%B8%E8%BF%9C%E6%97%A0%E6%B3%95%E8%8E%B7%E5%BE%97%E5%B9%B3%E9%9D%99/" title="或许我们永远无法获得平静">或许我们永远无法获得平静</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/code/" title="分类于 代码">代码</a> <i class="ic i-angle-right"></i> <a href="/categories/code/OI/" title="分类于 OI">OI</a></div><span><a href="/code/Tarjan/" title="Tarjan">Tarjan</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/note/" title="分类于 影视书籍">影视书籍</a> <i class="ic i-angle-right"></i> <a href="/categories/note/%E5%8A%A8%E6%BC%AB/" title="分类于 动漫">动漫</a></div><span><a href="/note/%E4%BD%A0%E6%83%B3%E6%B4%BB%E5%87%BA%E6%80%8E%E6%A0%B7%E7%9A%84%E4%BA%BA%E7%94%9F/" title="你想活出怎样的人生">你想活出怎样的人生</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/code/" title="分类于 代码">代码</a> <i class="ic i-angle-right"></i> <a href="/categories/code/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" title="分类于 编程语言">编程语言</a></div><span><a href="/code/%E6%96%87%E4%BB%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="文件学习笔记">文件学习笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/article/" title="分类于 论文">论文</a></div><span><a href="/article/STAGATE/" title="STAGATE">STAGATE</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/life/" title="分类于 生活">生活</a> <i class="ic i-angle-right"></i> <a href="/categories/life/%E6%BC%94%E5%A5%8F%E4%BC%9A/" title="分类于 演奏会">演奏会</a></div><span><a href="/life/%E8%A7%82%E9%83%91%E6%99%9F%E6%B2%B3%E6%BC%94%E5%A5%8F%E4%BC%9A%E6%9C%89%E6%84%9F/" title="观郑晟河演奏会有感">观郑晟河演奏会有感</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/life/" title="分类于 生活">生活</a> <i class="ic i-angle-right"></i> <a href="/categories/life/%E4%BC%BC%E6%B0%B4%E6%B5%81%E5%B9%B4/" title="分类于 似水流年">似水流年</a></div><span><a href="/life/%E8%A7%81%E5%AD%97%E5%A6%82%E9%9D%A2/" title="见字如面">见字如面</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/code/" title="分类于 代码">代码</a> <i class="ic i-angle-right"></i> <a href="/categories/code/%E6%95%B0%E5%AD%A6%E5%BB%BA%E6%A8%A1/" title="分类于 数学建模">数学建模</a></div><span><a href="/code/%E6%8F%92%E5%80%BC%E7%AE%97%E6%B3%95/" title="插值算法">插值算法</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/article/" title="分类于 论文">论文</a></div><span><a href="/article/Matching-Anything-by-Segmenting-Anything/" title="Matching_Anything_by_Segmenting_Anything">Matching_Anything_by_Segmenting_Anything</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/code/" title="分类于 代码">代码</a> <i class="ic i-angle-right"></i> <a href="/categories/code/python/" title="分类于 python">python</a></div><span><a href="/code/%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0python3/" title="系统学习python（三）对于Anndata的整理">系统学习python（三）对于Anndata的整理</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Lemon Sour @ Amentiraz</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"code/系统学习python3/",favicon:{show:"⁽⁽ଘ( ˊᵕˋ )ଓ⁾⁾",hide:"(つд⊂)"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->